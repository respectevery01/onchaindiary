# 2/3 猜谜游戏

在加密货币历史上，首次实现了可创建具有隐藏状态的完全链上游戏。Inco 通过全同态加密（FHE）技术，为链上游戏解锁了全新机制。这将开启隐藏操作、资源遮蔽和战争迷雾机制的新型加密游戏时代。本文将通过博弈论经典案例"三分之二博弈"，探讨 FHE 如何实现隐藏操作机制。

迄今为止，完全链上游戏始终局限于完美信息博弈。以国际象棋和扑克为例：国际象棋中棋盘全局对双方可见，属于完美信息博弈；扑克玩家则只能看到自己的手牌，需要推测对手牌型，这属于隐藏信息博弈。现有成功加密游戏如 Axie Infinity、Crypto Kitties 和 Parallel 均属完美信息博弈。而 Inco 通用机密计算层的推出，将为隐藏信息游戏开辟全新的设计空间。

*值得注意的是，零知识证明（zk-proofs）可用于创建包含隐藏信息的游戏，但开发这类 zk 游戏的复杂度显著更高。正如您将看到的，Inco 让任何具备 Solidity 开发经验的人都能轻松构建此类游戏。*

一类融合战争迷雾（《帝国时代》《黑暗森林 v2》）、手牌隐藏（扑克、多米诺骨牌、卡坦岛）和情报隐匿（《海战棋》《战略大师》）等机制的新形态游戏正在兴起。

加密原生开发者还将利用全同态加密（FHE）打造新型社交与投机游戏。最令我感兴趣的正是这类创新游戏形态。带有隐藏机制的加密游戏将开创前所未有的游戏体验——既能提供娱乐价值、吸引用户关注，也为深度玩家创造了施展所长的机会：加大投注力度。

现在请允许我通过早期原型案例，具体说明何为社交型投机游戏。以下展示的是"三分之二博弈"及其在 Inco 网络上的实现框架。

在三分之二游戏中，玩家需从 1 至 100 中选择一个整数，目标是使所选数字最接近所有玩家提交数字平均值的三分之二。

游戏规则简单，但玩家的策略却可能变得复杂。玩家必须考虑选择背后的数学原理，并预测其他玩家对游戏的理解。

从数学角度看，如果每位参与者都猜测 100，平均值即为 100，那么解就是 66（100 的三分之二）。意识到其他人可能也会猜测 66，参与者现在会猜测 66 的三分之二，即 44。这种迭代逻辑可以一直重复下去，直到解达到可能的最小数字 1。

从社交层面看，这个游戏变成了对他人理解程度的测试，形成了层层递推的演绎与预测。其他参与者对游戏规则的理解程度如何？其他参与者认为我对游戏规则的理解程度如何？其他参与者认为其他参与者对游戏规则的理解程度如何？在经济学中，这些问题涉及理性与共同知识的探讨。

历史上，答案的分布范围极为广泛，这体现了游戏的复杂性及玩家策略的多样性。该游戏每年在哈佛大学博弈论课程中进行，得出的答案范围在 13 至 33 之间；丹麦一家报纸曾收集超过 19,000 份参赛答案，最终结果为 22；而 TED 演讲社区的玩家们则得出了 21 的结果。

最近，Inco 在 ETHDenver 2024 大会上举办了这款游戏！共有 22 名玩家参与，参赛作品分布如下：

获胜方案是 16 号，由一位幸运的赢家选中！

既然我们已经了解了游戏机制，接下来就探讨如何利用全同态加密（FHE）在链上实现它。

**进入游戏**

enterGame 函数负责处理玩家输入。该函数首先接收密文并将其转换为加密整数。随后将输入值累加至 enSum 中，该变量存储所有玩家输入的加密总和。

系统会执行额外检查以确认游戏处于进行状态、玩家尚未提交过输入，且其输入值不大于 100 且大于 0。

**胜负判定**

游戏结束后，通过计算平均值的 2/3 得出解决方案，此时使用 winCheck 函数来确定游戏的获胜者。

对于少量玩家，遍历玩家条目即可满足需求；然而——该函数的结构设计允许无限玩家参与。当玩家数量众多时，使用 for 循环计算量过大。因此我们改为让每位玩家自行检查其答案是否获胜。若玩家的答案最接近解决方案，则该玩家将被添加到获胜者数组中。这可以视为一种用户导向的搜索算法。

**使用重新加密技术优化用户界面**

为鼓励获胜玩家领取奖励并防止失败玩家浪费 gas 费，可在前端主动提示获胜玩家进行领取操作。

通过使用仅查看型重加密功能，我们可以逐一验证每个解题方案，随后提示获胜者进行领取。重加密是 TFHE 库中的一项功能，它调用 Inco 网络中的节点在链下完全解密输入数据。该过程无需消耗 gas 费，因此游戏开发者可为所有玩家条目运行此功能。

这在不牺牲游戏可验证性的前提下优化了用户体验。游戏本身保持可验证且去信任化，因为玩家仍可独立于前端在链上自行验证解题结果。

完整实现请参见 GitHub 上 0xAkrasia 的“[三分之二游戏](https://github.com/0xAkrasia/In-Theory-Games/blob/main/src/components/Contracts/twoThirdsGame_vInco.sol)”。

这款游戏是 Melee 打造的首款社交与策略游戏系列作品。关注我们的 Twitter 账号@MeleeCrypto，获取最新游戏动态。若您有意基于 FHE 技术开发游戏，请通过 Twitter 联系@0xAkrasia。有关 FHE 技术原理的更多信息，请查阅[ Inco 技术文档](https://docs.inco.org/home)。
